[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": null,
  "modified": "2024-04-08 13:59:36.211846",
  "module": "Tropisme",
  "name": "Event",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Event",
  "script": "STATUS_MAP = {\n    \"Option\": \"Not confirmed\",\n    \"Validated\": \"Confirmed\",\n    \"Cancelled\": \"Cancelled\"\n}\n\nbookings = frappe.get_all(\"Item Booking\", filters={\"event\": doc.name}, fields=[\"name\", \"status\"])\n\nfor booking in bookings:\n    if booking.status != STATUS_MAP.get(doc.status):\n        frappe.db.set_value(\"Item Booking\", booking.name, \"status\", STATUS_MAP.get(doc.status))\n    ib = frappe.get_doc(\"Item Booking\", booking.name)\n    ib.starts_on = doc.starts_on\n    ib.ends_on = doc.ends_on\n    ib.save()",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": null,
  "modified": "2020-12-18 19:06:48.031480",
  "module": null,
  "name": "Nom des clients",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Customer",
  "script": "excluded_characters = \"!@#$%^&*()[]{};:,./<>?\\|`~-=_+'\"\n\ncharacters_to_replace = {\n    \"é\": \"e\",\n    \"è\": \"e\",\n    \"à\": \"a\",\n    \"â\": \"a\"\n}\n\nexcluded_words = [\"l\", \"le\", \"la\", \"sas\", \"sarl\", \"sasu\"]\n\nexcluded_characters_list = []\nexcluded_characters_list[:0] = excluded_characters\n\nkeys = frappe.utils.strip(doc.customer_name).replace(\"'\", \" \").split(\" \")\n\nnew_name = \"C\"\nfor key in keys:\n    if key.lower() in excluded_words:\n       continue\n       \n    new_name = new_name + key\n\nfor e in excluded_characters_list:\n    new_name = new_name.lower().replace(e, \"\")\n    \nfor char in characters_to_replace:\n    new_name = new_name.lower().replace(char, characters_to_replace[char])\n\ndoc.name = new_name.upper()\n\ndoc.flags.name_set = True",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": null,
  "modified": "2020-12-18 19:10:57.363000",
  "module": null,
  "name": "Nom des fournisseurs",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Supplier",
  "script": "excluded_characters = \"!@#$%^&*()[]{};:,./<>?\\|`~-=_+'\"\n\ncharacters_to_replace = {\n    \"é\": \"e\",\n    \"è\": \"e\",\n    \"à\": \"a\",\n    \"â\": \"a\"\n}\n\nexcluded_words = [\"l\", \"le\", \"la\", \"sas\", \"sarl\", \"sasu\"]\n\nexcluded_characters_list = []\nexcluded_characters_list[:0] = excluded_characters\n\nkeys = frappe.utils.strip(doc.customer_name).replace(\"'\", \" \").split(\" \")\n\nnew_name = \"F\"\nfor key in keys:\n    if key.lower() in excluded_words:\n       continue\n       \n    new_name = new_name + key\n\nfor e in excluded_characters_list:\n    new_name = new_name.lower().replace(e, \"\")\n    \nfor char in characters_to_replace:\n    new_name = new_name.lower().replace(char, characters_to_replace[char])\n\ndoc.name = new_name.upper()\n\ndoc.flags.name_set = True",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.360672",
  "module": "Tropisme",
  "name": "Evenement - Avant validation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Event",
  "script": "doc.published = 1 if doc.status ==\"Validated\" else 0",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.316208",
  "module": "Tropisme",
  "name": "Fiche Organisateur",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Organisateur",
  "script": "before_save = doc.get_doc_before_save()\nif before_save:\n    if before_save.get(\"workflow_state\") == \"Pending\" and doc.workflow_state == \"Approuvé par un gestionnaire\":\n        doc.first_approver = frappe.session.user\n        \nif doc.evenement:\n    event = frappe.get_doc(\"Event\", doc.evenement)\n    if not event.repeat_this_event:\n        if doc.sous_titre_evenement and doc.sous_titre_evenement != event.courte_description:\n            frappe.db.set_value(\"Event\", doc.evenement, \"courte_description\", doc.sous_titre_evenement)\n            \n        if doc.date_et_heure_de_début and doc.date_et_heure_de_début != event.starts_on:\n            frappe.db.set_value(\"Event\", doc.evenement, \"starts_on\", doc.date_et_heure_de_début)\n            \n        if doc.date_et_heure_de_fin and doc.date_et_heure_de_fin != event.ends_on:\n            frappe.db.set_value(\"Event\", doc.evenement, \"ends_on\", doc.date_et_heure_de_fin)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.340819",
  "module": "Tropisme",
  "name": "Fiche Organisateur - Avant insertion",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Organisateur",
  "script": "if doc.evenement:\n    doc = frappe.get_doc(\"Event\", doc.evenement)\n    doc.run_notifications(\"nouvelle_fiche_orga\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 1,
  "api_method": "technical-team-assignment",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.107862",
  "module": "Tropisme",
  "name": "API Equipe Technique",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "if frappe.form_dict.get(\"event\"):\n    if frappe.form_dict.get(\"id\"):\n        status = \"Validé\" if frappe.form_dict.get(\"ans\") == \"1\" else \"Refusé\"\n        frappe.db.set_value(\"Equipe Technique\", frappe.form_dict.get(\"id\"), \"statut\", status)\n\n        # event = frappe.get_doc(\"Event\", frappe.form_dict.get(\"event\"))\n        # assigned_users = event.get_assigned_users()\n\n        doc = frappe.new_doc(\"Validation Equipe Technique\")\n        doc.evenement = frappe.form_dict.get(\"event\")\n        doc.line_id = frappe.form_dict.get(\"id\")\n        doc.reponse = status\n        doc.employee = frappe.db.get_value(\"Equipe Technique\", frappe.form_dict.get(\"id\"), \"employe\")\n        doc.insert(ignore_permissions=True)\n        frappe.db.commit()\n        \n        # doc = frappe.get_doc(\"Event\", frappe.form_dict.get(\"event\"))\n        # doc.run_notifications(\"validation_equipe_technique\")\n\n        frappe.response['type'] = 'redirect'\n        frappe.response.location = \"/message?title=Merci&message=Votre réponse a bien été enregistrée\"\n        \n    else:\n        frappe.response['type'] = 'redirect'\n        frappe.response.location = \"/message?title=Erreur&message=Votre réponse n'a pas pu être enregistrée correctement\"\n        \nelse:\n    frappe.response['type'] = 'redirect'\n    frappe.response.location = \"/message?title=Erreur&message=Votre réponse n'a pas pu être enregistrée correctement\"",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.074250",
  "module": "Tropisme",
  "name": "Notification Equipe Technique",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Event",
  "script": "email_template = \"\"\"\n<p>Bonjour,</p>\n\n<p>Vous avez été proposé au poste de {{ row.type }} de l'événement {{ doc.subject }} du {{ frappe.utils.format_date(row.jour) }}, à la Halle Tropisme.</p>\n{% if row.horaires %}\n<p>Horaires: {{ row.horaires }}</p>\n{% endif %}\n\n<p>Souhaitez-vous effectuer cette mission ?</p>\n\n<table>\n<tbody>\n<tr>\n<td>\n{% set link = \"https://tropisme.dokos.cloud/affectation-evenement?id=\" + row.name + \"&event=\" + doc.name + \"&ans=\" %}\n{% set yes = link + \"1\" %}\n<a class=\"btn btn-primary\" href={{ yes }}>Oui</a>\n</td>\n\n<td>\n{% set no = link + \"0\" %}\n<a class=\"btn btn-default\" href={{ no }}>Non</a>\n</td>\n</tr>\n</tbody>\n</table>\n\n\"\"\"\n\nif doc.technical_team_required:\n    for line in doc.equipe_technique:\n        if line.jour and doc.starts_on and doc.ends_on and not (frappe.utils.getdate(doc.ends_on) >= frappe.utils.getdate(line.jour) >= frappe.utils.getdate(doc.starts_on)):\n            frappe.throw(f\"La date saisie à la ligne {line.idx} du tableau Equipe Technique n'est pas comprise dans les dates de l'événement\")\n\n        if line.type and line.utilisateur and line.statut == \"Notification à envoyer\":\n            message = frappe.render_template(email_template, {\n                \"doc\": doc,\n                \"row\": line\n            })\n            frappe.sendmail(\n                recipients=line.utilisateur,\n    \t\t\tsubject=\"TROPISME // Proposition d'événement le {{ frappe.utils.format_date(line.jour) }}\",\n    \t\t\tmessage=message,\n    \t\t\treference_doctype=doc.doctype,\n    \t\t\treference_name=doc.name,\n    \t\t\texpose_recipients=\"header\"\n            )\n            line.statut = \"Option\"",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "Daily",
  "modified": "2024-04-08 13:59:36.244976",
  "module": "Tropisme",
  "name": "Refus automatique après 72h",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Event",
  "script": "for line in frappe.get_all(\"Equipe Technique\", filters={\"statut\": \"Option\"}, fields=[\"name\", \"parenttype\", \"creation\"]):\n    if line.parenttype == \"Event\" and frappe.utils.time_diff_in_hours(frappe.utils.now_datetime(), line.creation) > 72:\n        frappe.db.set_value(\"Equipe Technique\", line.name, \"statut\", \"Aucune réponse\")",
  "script_type": "Scheduler Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.228838",
  "module": "Tropisme",
  "name": "Titre des devis",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Quotation",
  "script": "if doc.event:\n    event_subject = frappe.db.get_value(\"Event\", doc.event, \"subject\")\n    if event_subject:\n        doc.title = f\"{event_subject}: {doc.customer_name or ''}\"[:139]",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "get_quotation_from_event",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.125708",
  "module": "Tropisme",
  "name": "Création de devis",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "event_name = frappe.form_dict.name\nevent = json.loads(frappe.form_dict.doc)\ncost_center = frappe.form_dict.cost_center\n\nitems = []\n\n# Réservations d'articles\nfor booking in frappe.get_all(\"Item Booking\", filters={\"event\": event_name, \"status\": (\"in\", (\"Confirmed\", \"Not Confirmed\"))}, pluck=\"item\"):\n    items.append({\n        \"item_code\": booking,\n        \"qty\": 1,\n        \"event\": event_name,\n        \"cost_center\": cost_center\n    })\n    \n# Equipe technique\nfor agent in event.get(\"equipe_technique\", []):\n    if frappe.db.get_value(\"Item\", agent.get(\"type\")):\n        items.append({\n            \"item_code\": agent.get(\"type\"),\n            \"qty\": 1,\n            \"event\": event_name,\n            \"cost_center\": cost_center\n        })\n    else:\n        frappe.throw(f\"Veuillez créer un article pour le type d'agent technique: {agent.get('type')}\")\n\n# Equipe technique\nfor agent in event.get(\"equipe_securite\", []):\n    if frappe.db.get_value(\"Item\", agent.get(\"type_agent\")):\n        items.append({\n            \"item_code\": agent.get(\"type_agent\"),\n            \"qty\": agent.get(\"nombre_dheures\") * agent.get(\"unites\"),\n            \"uom\": agent.get(\"tarif\"),\n            \"event\": event_name,\n            \"cost_center\": cost_center\n        })\n    else:\n        frappe.throw(f\"Veuillez créer un article pour le type d'agent de sécurité: {agent.get('type_agent')}\")\n\nif event.get(\"besoins_ménage\"):\n    items.append({\n        \"item_code\": \"Forfait Ménage\",\n        \"qty\": 1,\n        \"event\": event_name,\n        \"cost_center\": cost_center\n    })\n\nif not items:\n    frappe.throw(\"Aucun article à facturer n'a été trouvé dans cet événement.\")\n\nquotation = frappe.new_doc(\"Quotation\")\nquotation.update({\n    \"items\": items,\n    \"quotation_to\": \"Customer\",\n    \"party_name\": event.get(\"customer\"),\n    \"cost_center\": cost_center,\n    \"company\": frappe.db.get_value(\"Cost Center\", cost_center, \"company\"),\n    \"event\": event_name,\n    \"taxes_and_charges\": \"TVA 20% - HT\"\n})\nquotation.set_missing_values()\n\nfrappe.response[\"message\"] = quotation",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Validate",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.190817",
  "module": "Tropisme",
  "name": "Validation des devis",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Quotation",
  "script": "doc.letter_head = \"Halle Tropisme Sans Logo\"\n\nfor item in doc.items:\n    for field in [\"project\", \"event\"]:\n        if not item.get(field):\n            item.update({field: doc.get(field)})\n        \n    if not doc.code_analytique_different:\n        item.cost_center = doc.cost_center",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Validate",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.149681",
  "module": "Tropisme",
  "name": "Validation des factures",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Invoice",
  "script": "doc.letter_head = \"Halle Tropisme Sans Logo\"\n\nfor item in doc.items:\n    item.remarks = f\"{doc.customer_name} {item.item_name} {doc.objet}\"\n\n    if not doc.code_analytique_different:\n        item.cost_center = doc.cost_center\n    \nfor tax in doc.taxes:\n    tax.remarks = f\"{doc.customer_name} {doc.objet}\"\n    \ndoc.remarks = f\"{doc.customer_name} {doc.objet}\"",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Validate",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.169768",
  "module": "Tropisme",
  "name": "Validation des commandes",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Order",
  "script": "doc.letter_head = \"Halle Tropisme Sans Logo\"\n\nfor item in doc.items:\n    if not doc.code_analytique_different:\n        item.cost_center = doc.cost_center",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "get_bookings_and_assignee",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.092011",
  "module": "Tropisme",
  "name": "API Salles et attributions",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "",
  "script": "event = frappe.form_dict.get(\"event\")\ndoc = frappe.get_doc(\"Event\", event)\n\nfrappe.response['message'] = {\n    \"bookings\": frappe.get_all(\"Item Booking\", filters={\"event\": doc.name}, fields=[\"name\", \"status\"]),\n    \"assignees\": doc.get_assigned_users()\n}",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.045442",
  "module": "Tropisme",
  "name": "Fiche Communication",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Communication",
  "script": "before_save = doc.get_doc_before_save()\nif before_save:\n    if before_save.get(\"workflow_state\") == \"Pending\" and doc.workflow_state == \"Approuvé par un gestionnaire\":\n        doc.first_approver = frappe.session.user\n        \nif doc.evenement:\n    event = frappe.get_doc(\"Event\", doc.evenement)\n    if not event.repeat_this_event:\n        if doc.sous_titre_evenement and doc.sous_titre_evenement != event.courte_description:\n            frappe.db.set_value(\"Event\", doc.evenement, \"courte_description\", doc.sous_titre_evenement)\n            \n        if doc.date_et_heure_de_début and doc.date_et_heure_de_début != event.starts_on:\n            frappe.db.set_value(\"Event\", doc.evenement, \"starts_on\", doc.date_et_heure_de_début)\n            \n        if doc.date_et_heure_de_fin and doc.date_et_heure_de_fin != event.ends_on:\n            frappe.db.set_value(\"Event\", doc.evenement, \"ends_on\", doc.date_et_heure_de_fin)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.026898",
  "module": "Tropisme",
  "name": "Fiche communication - Notification",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Communication",
  "script": "if doc.evenement:\n    doc = frappe.get_doc(\"Event\", doc.evenement)\n    doc.run_notifications(\"nouvelle_fiche_communication\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:36.008032",
  "module": "Tropisme",
  "name": "Fiche Technique - Notification",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Technique",
  "script": "if doc.evenement:\n    doc = frappe.get_doc(\"Event\", doc.evenement)\n    doc.run_notifications(\"nouvelle_fiche_technique\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:35.987004",
  "module": "Tropisme",
  "name": "Fiche Client - Notification",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Client",
  "script": "if doc.evenement:\n    doc = frappe.get_doc(\"Event\", doc.evenement)\n    doc.run_notifications(\"nouvelle_fiche_client\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:35.963270",
  "module": "Tropisme",
  "name": "Fichiers déposés en ligne - Fiche Communication",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Communication",
  "script": "if doc.owner == \"Guest\":\n    for file in doc.pieces_jointes:\n        piece_jointe = frappe.db.get_value(\"File\", dict(file_url=file.piece_jointe))\n        frappe.db.set_value(\"File\", piece_jointe, \"attached_to_doctype\", doc.doctype)\n        frappe.db.set_value(\"File\", piece_jointe, \"attached_to_name\", doc.name)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:35.936450",
  "module": "Tropisme",
  "name": "Fichiers déposés en ligne - Fiche Technique",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Fiche Technique",
  "script": "if doc.owner == \"Guest\":\n    for file in doc.fiches_techniques:\n        piece_jointe = frappe.db.get_value(\"File\", dict(file_url=file.piece_jointe))\n        frappe.db.set_value(\"File\", piece_jointe, \"attached_to_doctype\", doc.doctype)\n        frappe.db.set_value(\"File\", piece_jointe, \"attached_to_name\", doc.name)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-08 13:59:35.819411",
  "module": "Tropisme",
  "name": "Piste depuis une demande de privatisation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Demande de privatisation",
  "script": "lead = frappe.new_doc(\"Lead\")\nlead.first_name = doc.nom_prénom\nlead.company_name = doc.nom_de_lentreprise\nlead.email = doc.adresse_email\nlead.mobile_no = doc.n_de_telephone\n#lead.XXXX = doc.cahier_des_charges\nlead.insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 }
]